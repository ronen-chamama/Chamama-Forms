{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/chamama-forms/lib/firebaseClient.ts"],"sourcesContent":["// lib/firebaseClient.ts\r\nimport { initializeApp, getApps, type FirebaseApp } from \"firebase/app\";\r\nimport { getAuth, connectAuthEmulator } from \"firebase/auth\";\r\nimport { getFirestore, connectFirestoreEmulator } from \"firebase/firestore\";\r\nimport { getStorage, connectStorageEmulator } from \"firebase/storage\";\r\n\r\n// --- אבחון: ודא שמשתני הסביבה קיימים (גם בשרת של Next וגם בדפדפן) ---\r\nconst cfg = {\r\n  apiKey: process.env.NEXT_PUBLIC_FB_API_KEY,\r\n  authDomain: process.env.NEXT_PUBLIC_FB_AUTH_DOMAIN,\r\n  projectId: process.env.NEXT_PUBLIC_FB_PROJECT_ID,\r\n  storageBucket: process.env.NEXT_PUBLIC_FB_STORAGE_BUCKET,\r\n  appId: process.env.NEXT_PUBLIC_FB_APP_ID,\r\n};\r\n\r\n// נבדוק את כל המפתחות החיוניים ונזרוק שגיאה ברורה אם חסר משהו:\r\nconst missing = Object.entries(cfg).filter(([_, v]) => !v).map(([k]) => k);\r\nif (missing.length) {\r\n  // חשוב: ההודעה תופיע במסוף וגם תעצור את הייבוא בצורה ברורה\r\n  throw new Error(\r\n    \"Firebase env missing: \" + missing.join(\", \") +\r\n    \". ודא שיש קובץ .env.local בשורש הפרויקט עם NEXT_PUBLIC_FB_* אמיתיים, ואתחל מחדש את dev.\"\r\n  );\r\n}\r\n\r\nconst firebaseConfig = cfg as {\r\n  apiKey: string; authDomain: string; projectId: string; storageBucket: string; appId: string;\r\n};\r\n\r\nlet app: FirebaseApp;\r\ntry {\r\n  app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);\r\n} catch (e) {\r\n  // לוג מועיל לאבחון\r\n  // eslint-disable-next-line no-console\r\n  console.error(\"Firebase initializeApp failed. projectId:\", firebaseConfig.projectId, e);\r\n  throw e;\r\n}\r\n\r\nexport { app };\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app);\r\nexport const storage = getStorage(app);\r\n\r\n// חיבור לאמולטורים בלוקאל\r\nif (typeof window !== \"undefined\" && location.hostname === \"localhost\") {\r\n  try { connectAuthEmulator(auth, \"http://localhost:9099\"); } catch {}\r\n  try { connectFirestoreEmulator(db, \"localhost\", 8080); } catch {}\r\n  try { connectStorageEmulator(storage, \"localhost\", 9199); } catch {}\r\n}\r\n"],"names":[],"mappings":"AAAA,wBAAwB;;;;;;;;;;;AAQd;AAPV;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;;;;;AAEA,uEAAuE;AACvE,MAAM,MAAM;IACV,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,KAAK;AACP;AAEA,+DAA+D;AAC/D,MAAM,UAAU,OAAO,OAAO,CAAC,KAAK,MAAM,CAAC;QAAC,CAAC,GAAG,EAAE;WAAK,CAAC;GAAG,GAAG,CAAC;QAAC,CAAC,EAAE;WAAK;;AACxE,IAAI,QAAQ,MAAM,EAAE;IAClB,2DAA2D;IAC3D,MAAM,IAAI,MACR,2BAA2B,QAAQ,IAAI,CAAC,QACxC;AAEJ;AAEA,MAAM,iBAAiB;AAIvB,IAAI;AACJ,IAAI;IACF,MAAM,IAAA,8KAAO,IAAG,MAAM,GAAG,IAAA,8KAAO,GAAE,CAAC,EAAE,GAAG,IAAA,oLAAa,EAAC;AACxD,EAAE,OAAO,GAAG;IACV,mBAAmB;IACnB,sCAAsC;IACtC,QAAQ,KAAK,CAAC,6CAA6C,eAAe,SAAS,EAAE;IACrF,MAAM;AACR;;AAGO,MAAM,OAAO,IAAA,wKAAO,EAAC;AACrB,MAAM,KAAK,IAAA,kLAAY,EAAC;AACxB,MAAM,UAAU,IAAA,8KAAU,EAAC;AAElC,0BAA0B;AAC1B,IAAI,aAAkB,eAAe,SAAS,QAAQ,KAAK,aAAa;IACtE,IAAI;QAAE,IAAA,oLAAmB,EAAC,MAAM;IAA0B,EAAE,UAAM,CAAC;IACnE,IAAI;QAAE,IAAA,8LAAwB,EAAC,IAAI,aAAa;IAAO,EAAE,UAAM,CAAC;IAChE,IAAI;QAAE,IAAA,0LAAsB,EAAC,SAAS,aAAa;IAAO,EAAE,UAAM,CAAC;AACrE","debugId":null}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///C:/chamama-forms/app/app/forms/%5Bid%5D/edit/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport { db } from \"@/lib/firebaseClient\";\r\nimport { doc, getDoc, updateDoc, serverTimestamp, arrayUnion } from \"firebase/firestore\";\r\n\r\ntype Field = { id:string; type:string; label:string; options?:string[]; required?:boolean; };\r\n\r\nexport default function EditFormPage(){\r\n  const { id } = useParams<{id:string}>();\r\n  const [loading,setLoading]=useState(true);\r\n  const [title,setTitle]=useState(\"\");\r\n  const [groups,setGroups]=useState<string>(\"\");\r\n  const [emails,setEmails]=useState<string>(\"\");\r\n  const [schema,setSchema]=useState<Field[]>([]);\r\n\r\n  useEffect(()=>{ (async()=>{\r\n    const snap=await getDoc(doc(db,\"forms\",id)); const d=snap.data() as any;\r\n    setTitle(d?.title||\"\"); setGroups((d?.targetGroups||[]).join(\", \")); setEmails((d?.notifyStaffEmails||[]).join(\", \"));\r\n    setSchema(d?.schema||[]); setLoading(false);\r\n  })(); },[id]);\r\n\r\n  async function save(){\r\n    await updateDoc(doc(db,\"forms\",id),{\r\n      title,\r\n      targetGroups: groups.split(\",\").map(s=>s.trim()).filter(Boolean),\r\n      notifyStaffEmails: emails.split(\",\").map(s=>s.trim()).filter(Boolean),\r\n      schema,\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    alert(\"נשמר\");\r\n  }\r\n\r\n  function addField(type:string){\r\n    const base: Field = { id: crypto.randomUUID(), type, label: \"שדה חדש\", required:false };\r\n    if(type===\"select\"||type===\"radio\"||type===\"checkbox\"){ base.options=[\"אפשרות 1\",\"אפשרות 2\"]; }\r\n    setSchema(prev=>[...prev, base]);\r\n  }\r\n\r\n  if(loading) return <main className=\"p-6\">טוען…</main>;\r\n  return (\r\n    <main dir=\"rtl\" className=\"p-6 max-w-4xl mx-auto\">\r\n      <h1 className=\"text-2xl mb-4\">עריכת טופס</h1>\r\n\r\n      <div className=\"grid gap-3 max-w-xl\">\r\n        <input className=\"border p-2\" value={title} onChange={e=>setTitle(e.target.value)} placeholder=\"שם הטופס\" />\r\n        <input className=\"border p-2\" value={groups} onChange={e=>setGroups(e.target.value)} placeholder=\"קבוצות (מופרד בפסיקים)\" />\r\n        <input className=\"border p-2\" value={emails} onChange={e=>setEmails(e.target.value)} placeholder=\"מיילים לשליחה (מופרד בפסיקים)\" />\r\n      </div>\r\n\r\n      <div className=\"mt-6\">\r\n        <h2 className=\"text-xl mb-2\">רכיבי טופס</h2>\r\n        <div className=\"flex flex-wrap gap-2 mb-3\">\r\n          <button className=\"border p-2\" onClick={()=>addField(\"richtext\")}>טקסט עשיר</button>\r\n          <button className=\"border p-2\" onClick={()=>addField(\"text\")}>שדה טקסט</button>\r\n          <button className=\"border p-2\" onClick={()=>addField(\"phone\")}>טלפון</button>\r\n          <button className=\"border p-2\" onClick={()=>addField(\"email\")}>דוא\"ל</button>\r\n          <button className=\"border p-2\" onClick={()=>addField(\"select\")}>רשימה נגללת</button>\r\n          <button className=\"border p-2\" onClick={()=>addField(\"radio\")}>בחירה אחת</button>\r\n          <button className=\"border p-2\" onClick={()=>addField(\"checkbox\")}>סימונים</button>\r\n          <button className=\"border p-2\" onClick={()=>addField(\"signature\")}>חתימה</button>\r\n        </div>\r\n\r\n        <ul className=\"space-y-2\">\r\n          {schema.map(f=>(\r\n            <li key={f.id} className=\"border p-2 rounded\">\r\n              <div className=\"flex gap-2 items-center\">\r\n                <span className=\"text-xs px-2 py-1 border rounded\">{f.type}</span>\r\n                <input className=\"border p-1 flex-1\" value={f.label} onChange={e=>setSchema(s=>s.map(x=>x.id===f.id?{...x,label:e.target.value}:x))}/>\r\n                <label className=\"flex items-center gap-1 text-sm\"><input type=\"checkbox\" checked={!!f.required} onChange={e=>setSchema(s=>s.map(x=>x.id===f.id?{...x,required:e.target.checked}:x))}/> נדרש</label>\r\n                <button className=\"text-red-600\" onClick={()=>setSchema(s=>s.filter(x=>x.id!==f.id))}>מחק</button>\r\n              </div>\r\n              {(f.type===\"select\"||f.type===\"radio\"||f.type===\"checkbox\") && (\r\n                <input className=\"border p-1 mt-2 w-full\" value={(f.options||[]).join(\", \")} onChange={e=>{\r\n                  const opts=e.target.value.split(\",\").map(s=>s.trim()).filter(Boolean);\r\n                  setSchema(s=>s.map(x=>x.id===f.id?{...x,options:opts}:x));\r\n                }} placeholder=\"אפשרויות (מופרד בפסיקים)\"/>\r\n              )}\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n\r\n      <button className=\"border p-2 mt-6\" onClick={save}>שמור</button>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AAAA;;;AAJA;;;;;AAQe,SAAS;;IACtB,MAAM,EAAE,EAAE,EAAE,GAAG,IAAA,kJAAS;IACxB,MAAM,CAAC,SAAQ,WAAW,GAAC,IAAA,yKAAQ,EAAC;IACpC,MAAM,CAAC,OAAM,SAAS,GAAC,IAAA,yKAAQ,EAAC;IAChC,MAAM,CAAC,QAAO,UAAU,GAAC,IAAA,yKAAQ,EAAS;IAC1C,MAAM,CAAC,QAAO,UAAU,GAAC,IAAA,yKAAQ,EAAS;IAC1C,MAAM,CAAC,QAAO,UAAU,GAAC,IAAA,yKAAQ,EAAU,EAAE;IAE7C,IAAA,0KAAS;kCAAC;YAAM;0CAAC;oBACf,MAAM,OAAK,MAAM,IAAA,4KAAM,EAAC,AADV,IACU,yKAAG,AAG5B,EAH6B,8HAAE,EAAC,SAAQ;oBAAM,MAAM,IAAE,KAAK,IAAI;oBAC9D,SAAS,CAAA,cAAA,wBAAA,EAAG,KAAK,KAAE;oBAAK,UAAU,CAAC,CAAA,cAAA,wBAAA,EAAG,YAAY,KAAE,EAAE,EAAE,IAAI,CAAC;oBAAQ,UAAU,CAAC,CAAA,cAAA,wBAAA,EAAG,iBAAiB,KAAE,EAAE,EAAE,IAAI,CAAC;oBAC/G,UAAU,CAAA,cAAA,wBAAA,EAAG,MAAM,KAAE,EAAE;oBAAG,WAAW;gBACvC;;QAAM;iCAAE;QAAC;KAAG;IAEZ,eAAe;QACb,MAAM,IAAA,+KAAS,EAAC,IAAA,yKAAG,EAAC,8HAAE,EAAC,SAAQ,KAAI;YACjC;YACA,cAAc,OAAO,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAG,EAAE,IAAI,IAAI,MAAM,CAAC;YACxD,mBAAmB,OAAO,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAG,EAAE,IAAI,IAAI,MAAM,CAAC;YAC7D;YACA,WAAW,IAAA,qLAAe;QAC5B;QACA,MAAM;IACR;IAEA,SAAS,SAAS,IAAW;QAC3B,MAAM,OAAc;YAAE,IAAI,OAAO,UAAU;YAAI;YAAM,OAAO;YAAW,UAAS;QAAM;QACtF,IAAG,SAAO,YAAU,SAAO,WAAS,SAAO,YAAW;YAAE,KAAK,OAAO,GAAC;gBAAC;gBAAW;aAAW;QAAE;QAC9F,UAAU,CAAA,OAAM;mBAAI;gBAAM;aAAK;IACjC;IAEA,IAAG,SAAS,qBAAO,6LAAC;QAAK,WAAU;kBAAM;;;;;;IACzC,qBACE,6LAAC;QAAK,KAAI;QAAM,WAAU;;0BACxB,6LAAC;gBAAG,WAAU;0BAAgB;;;;;;0BAE9B,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAM,WAAU;wBAAa,OAAO;wBAAO,UAAU,CAAA,IAAG,SAAS,EAAE,MAAM,CAAC,KAAK;wBAAG,aAAY;;;;;;kCAC/F,6LAAC;wBAAM,WAAU;wBAAa,OAAO;wBAAQ,UAAU,CAAA,IAAG,UAAU,EAAE,MAAM,CAAC,KAAK;wBAAG,aAAY;;;;;;kCACjG,6LAAC;wBAAM,WAAU;wBAAa,OAAO;wBAAQ,UAAU,CAAA,IAAG,UAAU,EAAE,MAAM,CAAC,KAAK;wBAAG,aAAY;;;;;;;;;;;;0BAGnG,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAAe;;;;;;kCAC7B,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAO,WAAU;gCAAa,SAAS,IAAI,SAAS;0CAAa;;;;;;0CAClE,6LAAC;gCAAO,WAAU;gCAAa,SAAS,IAAI,SAAS;0CAAS;;;;;;0CAC9D,6LAAC;gCAAO,WAAU;gCAAa,SAAS,IAAI,SAAS;0CAAU;;;;;;0CAC/D,6LAAC;gCAAO,WAAU;gCAAa,SAAS,IAAI,SAAS;0CAAU;;;;;;0CAC/D,6LAAC;gCAAO,WAAU;gCAAa,SAAS,IAAI,SAAS;0CAAW;;;;;;0CAChE,6LAAC;gCAAO,WAAU;gCAAa,SAAS,IAAI,SAAS;0CAAU;;;;;;0CAC/D,6LAAC;gCAAO,WAAU;gCAAa,SAAS,IAAI,SAAS;0CAAa;;;;;;0CAClE,6LAAC;gCAAO,WAAU;gCAAa,SAAS,IAAI,SAAS;0CAAc;;;;;;;;;;;;kCAGrE,6LAAC;wBAAG,WAAU;kCACX,OAAO,GAAG,CAAC,CAAA,kBACV,6LAAC;gCAAc,WAAU;;kDACvB,6LAAC;wCAAI,WAAU;;0DACb,6LAAC;gDAAK,WAAU;0DAAoC,EAAE,IAAI;;;;;;0DAC1D,6LAAC;gDAAM,WAAU;gDAAoB,OAAO,EAAE,KAAK;gDAAE,UAAU,CAAA,IAAG,UAAU,CAAA,IAAG,EAAE,GAAG,CAAC,CAAA,IAAG,EAAE,EAAE,KAAG,EAAE,EAAE,GAAC;gEAAC,GAAG,CAAC;gEAAC,OAAM,EAAE,MAAM,CAAC,KAAK;4DAAA,IAAE;;;;;;0DAChI,6LAAC;gDAAM,WAAU;;kEAAkC,6LAAC;wDAAM,MAAK;wDAAW,SAAS,CAAC,CAAC,EAAE,QAAQ;wDAAE,UAAU,CAAA,IAAG,UAAU,CAAA,IAAG,EAAE,GAAG,CAAC,CAAA,IAAG,EAAE,EAAE,KAAG,EAAE,EAAE,GAAC;wEAAC,GAAG,CAAC;wEAAC,UAAS,EAAE,MAAM,CAAC,OAAO;oEAAA,IAAE;;;;;;oDAAM;;;;;;;0DACvL,6LAAC;gDAAO,WAAU;gDAAe,SAAS,IAAI,UAAU,CAAA,IAAG,EAAE,MAAM,CAAC,CAAA,IAAG,EAAE,EAAE,KAAG,EAAE,EAAE;0DAAI;;;;;;;;;;;;oCAEvF,CAAC,EAAE,IAAI,KAAG,YAAU,EAAE,IAAI,KAAG,WAAS,EAAE,IAAI,KAAG,UAAU,mBACxD,6LAAC;wCAAM,WAAU;wCAAyB,OAAO,CAAC,EAAE,OAAO,IAAE,EAAE,EAAE,IAAI,CAAC;wCAAO,UAAU,CAAA;4CACrF,MAAM,OAAK,EAAE,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAG,EAAE,IAAI,IAAI,MAAM,CAAC;4CAC7D,UAAU,CAAA,IAAG,EAAE,GAAG,CAAC,CAAA,IAAG,EAAE,EAAE,KAAG,EAAE,EAAE,GAAC;wDAAC,GAAG,CAAC;wDAAC,SAAQ;oDAAI,IAAE;wCACxD;wCAAG,aAAY;;;;;;;+BAXV,EAAE,EAAE;;;;;;;;;;;;;;;;0BAkBnB,6LAAC;gBAAO,WAAU;gBAAkB,SAAS;0BAAM;;;;;;;;;;;;AAGzD;GA9EwB;;QACP,kJAAS;;;KADF","debugId":null}}]
}