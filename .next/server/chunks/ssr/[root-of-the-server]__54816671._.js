module.exports=[14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},54344,a=>{"use strict";a.s(["default",()=>l]);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(99996);a.i(30485);var f=a.i(31052);a.i(9912);var g=a.i(94318);a.i(69387);var h=a.i(60574);function i(a){return a?a instanceof Date?a:a?.toDate?a.toDate():"number"==typeof a?.seconds?new Date(1e3*a.seconds):null:null}function j(a){if(!a)return"-";try{return a.toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}catch{return a.toISOString()}}function k(a,b){if(null==b)return"";if(!a)return Array.isArray(b)?b.join(", "):"object"==typeof b?JSON.stringify(b):String(b);switch(a.type){case"checkbox":default:return Array.isArray(b)?b.join(", "):String(b);case"richtext":return String(b).replace(/<[^>]+>/g,"").trim()}}function l(){let{id:a}=(0,d.useParams)(),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(!0),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=(0,f.onAuthStateChanged)(e.auth,a=>{a?m(a.uid):location.href="/login"});return()=>a()},[]),(0,c.useEffect)(()=>{l&&(async()=>{o(!0);try{let b=(await (0,h.getDoc)((0,h.doc)(e.db,"forms",a))).data(),c=b?.schema||[];s(c);let d=(0,h.query)((0,h.collection)(e.db,"forms",a,"submissions"),(0,h.orderBy)("submittedAt","desc")),f=(await (0,h.getDocs)(d)).docs.map(a=>({id:a.id,...a.data()}));q(f)}finally{o(!1)}})()},[l,a]);let x=(0,c.useMemo)(()=>{let a=new Map;return r.forEach(b=>a.set(b.id,b)),a},[r]),y=(0,c.useMemo)(()=>{if(!t.trim())return p;let a=t.trim().toLowerCase();return p.filter(b=>{let c=[];for(let[a,d]of Object.entries(b.answers||{})){let b=x.get(a),e=b?.label||a,f=k(b,d);c.push(`${e}: ${f}`)}return c.join(" | ").toLowerCase().includes(a)})},[p,t,x]),[z,A]=(0,c.useState)(null);async function B(b){try{A(b);let c=(0,g.httpsCallable)(e.functions,"makePdf"),d=await c({formId:a,submissionId:b}),f=d?.data?.pdfUrl||"",h=d?.data?.fileName||`submission-${b}.pdf`;if(q(a=>a.map(a=>a.id===b?{...a,pdfUrl:f}:a)),f){let a=document.createElement("a");a.href=f,a.download=h,a.rel="noopener noreferrer",document.body.appendChild(a),a.click(),a.remove()}else console.warn("makePdf returned no pdfUrl",d)}catch(a){alert("שגיאה ביצירת PDF: "+(a?.message||a))}finally{A(null)}}return(0,b.jsxs)("main",{dir:"rtl",className:"p-6 max-w-6xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3 mb-4",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"הגשות לטופס"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{className:"border p-2 rounded w-64",placeholder:"חיפוש לפי שם שדה או ערך…",value:t,onChange:a=>u(a.target.value)}),(0,b.jsx)("button",{onClick:function(){let b=["id","submittedAt","status","signatureUrl","pdfUrl",...r.map(a=>a.label)],c=y.map(a=>{let b=[a.id,j(i(a.submittedAt)),a.status||"",a.signatureUrl||"",a.pdfUrl||""],c=a.answers||{};return[...b,...r.map(a=>k(a,c[a.id]))]}),d=new Blob([b.join(",")+"\n"+c.map(a=>a.map(a=>{let b=String(a??"");return b.includes(",")||b.includes("\n")||b.includes('"')?`"${b.replace(/"/g,'""')}"`:b}).join(",")).join("\n")],{type:"text/csv;charset=utf-8"}),e=URL.createObjectURL(d),f=document.createElement("a");f.href=e;let g=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");f.download=`submissions-${a}-${g}.csv`,f.click(),URL.revokeObjectURL(e)},className:"border p-2 rounded",children:"ייצוא CSV"}),(0,b.jsx)("a",{href:`/app/forms/${a}/edit`,className:"border p-2 rounded",children:"חזרה לעריכה"})]})]}),n?(0,b.jsx)("div",{children:"טוען…"}):0===y.length?(0,b.jsx)("div",{children:"אין הגשות עדיין."}):(0,b.jsx)("div",{className:"space-y-3",children:y.map(a=>{let c=j(i(a.submittedAt)),d=a.answers||{};return(0,b.jsxs)("div",{className:"border rounded p-3 bg-white",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:["נשלח: ",c," | סטטוס: ",a.status||"-"]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[a.signatureUrl?(0,b.jsx)("a",{href:a.signatureUrl,target:"_blank",className:"underline",children:"חתימה"}):(0,b.jsx)("span",{className:"text-gray-400",children:"אין חתימה"}),a.pdfUrl?(0,b.jsx)("a",{href:a.pdfUrl,target:"_blank",className:"underline",children:"PDF"}):(0,b.jsx)("button",{onClick:()=>B(a.id),className:"border px-2 py-1 rounded",disabled:z===a.id,title:"הפק מסמך PDF רשמי",children:z===a.id?"יוצר…":"הפק PDF"})]})]}),(0,b.jsx)("div",{className:"mt-3 grid sm:grid-cols-2 lg:grid-cols-3 gap-2",children:r.map(a=>{let c=d[a.id],e=k(a,c);return"signature"===a.type?null:(0,b.jsxs)("div",{className:"border rounded p-2",children:[(0,b.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:a.label}),(0,b.jsx)("div",{className:"text-sm break-words",children:e||(0,b.jsx)("span",{className:"text-gray-400",children:"—"})})]},a.id)})})]},a.id)})})]})}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__54816671._.js.map