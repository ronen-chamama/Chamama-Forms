{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/chamama-forms/lib/firebaseClient.ts"],"sourcesContent":["import { initializeApp, getApps, getApp } from \"firebase/app\";\r\nimport { getAuth, connectAuthEmulator } from \"firebase/auth\";\r\nimport { getFirestore, connectFirestoreEmulator } from \"firebase/firestore\";\r\nimport { getStorage, connectStorageEmulator } from \"firebase/storage\";\r\nimport { getFunctions, connectFunctionsEmulator } from \"firebase/functions\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.NEXT_PUBLIC_FB_API_KEY!,\r\n  authDomain: process.env.NEXT_PUBLIC_FB_AUTH_DOMAIN!,\r\n  projectId: process.env.NEXT_PUBLIC_FB_PROJECT_ID!,\r\n  storageBucket: process.env.NEXT_PUBLIC_FB_STORAGE_BUCKET!,\r\n  appId: process.env.NEXT_PUBLIC_FB_APP_ID!,\r\n};\r\n\r\nexport const app = getApps().length ? getApp() : initializeApp(firebaseConfig);\r\n\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app);\r\nexport const storage = getStorage(app);\r\n// חשוב: אזור תואם ל-export של הפונקציה\r\nexport const functions = getFunctions(app, \"us-central1\");\r\n\r\n// חיבור אמולטורים לוקאלית\r\nif (typeof window !== \"undefined\" && location.hostname === \"localhost\") {\r\n  connectAuthEmulator(auth, \"http://127.0.0.1:9099\");\r\n  connectFirestoreEmulator(db, \"127.0.0.1\", 8080);\r\n  connectStorageEmulator(storage, \"127.0.0.1\", 9199);\r\n  connectFunctionsEmulator(functions, \"127.0.0.1\", 5001);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;;;;;;AAEA,MAAM,iBAAiB;IACrB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,KAAK;AACP;AAEO,MAAM,MAAM,IAAA,2KAAO,IAAG,MAAM,GAAG,IAAA,0KAAM,MAAK,IAAA,iLAAa,EAAC;AAExD,MAAM,OAAO,IAAA,6KAAO,EAAC;AACrB,MAAM,KAAK,IAAA,iLAAY,EAAC;AACxB,MAAM,UAAU,IAAA,kMAAU,EAAC;AAE3B,MAAM,YAAY,IAAA,sLAAY,EAAC,KAAK;AAE3C,0BAA0B;AAC1B","debugId":null}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///C:/chamama-forms/components/DeleteFormButton.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { db, storage } from \"@/lib/firebaseClient\";\r\nimport {\r\n  collection,\r\n  deleteDoc,\r\n  doc,\r\n  getDocs,\r\n} from \"firebase/firestore\";\r\nimport { ref as sref, deleteObject } from \"firebase/storage\";\r\n\r\ntype Props = {\r\n  formId: string;\r\n  formTitle?: string;\r\n  onDeleted?: () => void; // כדי לעדכן את הרשימה UI אחרי מחיקה\r\n};\r\n\r\nasync function deleteFormDeep(formId: string) {\r\n  // מחיקת כל ההגשות\r\n  const subsSnap = await getDocs(collection(db, \"forms\", formId, \"submissions\"));\r\n  for (const d of subsSnap.docs) {\r\n    const data = d.data() as any;\r\n    const urls = [data?.signatureUrl, data?.pdfUrl].filter(Boolean) as string[];\r\n\r\n    // מחיקת קבצים ב-Storage אם יש URL\r\n    for (const url of urls) {\r\n      try {\r\n        // ref תומך גם ב-https/gs URLs\r\n        const fileRef = sref(storage, url);\r\n        await deleteObject(fileRef);\r\n      } catch (e) {\r\n        // לא מפילים מחיקה בגלל כשל במחיקת קובץ; מדפיסים אזהרה\r\n        console.warn(\"Storage delete failed (ignored):\", url, e);\r\n      }\r\n    }\r\n\r\n    // מחיקת מסמך ההגשה\r\n    await deleteDoc(doc(db, \"forms\", formId, \"submissions\", d.id));\r\n  }\r\n\r\n  // לבסוף – מחיקת מסמך הטופס\r\n  await deleteDoc(doc(db, \"forms\", formId));\r\n}\r\n\r\nexport default function DeleteFormButton({ formId, formTitle, onDeleted }: Props) {\r\n  const [busy, setBusy] = useState(false);\r\n\r\n  async function handleDelete() {\r\n    const name = formTitle?.trim() || formId;\r\n    const ok = confirm(`למחוק את הטופס \"${name}\"? הפעולה אינה ניתנת לשחזור.`);\r\n    if (!ok) return;\r\n\r\n    try {\r\n      setBusy(true);\r\n      await deleteFormDeep(formId);\r\n      onDeleted?.();\r\n    } catch (e: any) {\r\n      alert(\"מחיקה נכשלה: \" + (e?.message || e));\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <button\r\n      onClick={handleDelete}\r\n      disabled={busy}\r\n      className=\"text-red-600 hover:text-red-700 disabled:opacity-50 underline\"\r\n      title=\"מחק טופס\"\r\n    >\r\n      {busy ? \"מוחק…\" : \"מחק\"}\r\n    </button>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAMA;AAAA;AAVA;;;;;;AAkBA,eAAe,eAAe,MAAc;IAC1C,kBAAkB;IAClB,MAAM,WAAW,MAAM,IAAA,4KAAO,EAAC,IAAA,+KAAU,EAAC,2HAAE,EAAE,SAAS,QAAQ;IAC/D,KAAK,MAAM,KAAK,SAAS,IAAI,CAAE;QAC7B,MAAM,OAAO,EAAE,IAAI;QACnB,MAAM,OAAO;YAAC,MAAM;YAAc,MAAM;SAAO,CAAC,MAAM,CAAC;QAEvD,kCAAkC;QAClC,KAAK,MAAM,OAAO,KAAM;YACtB,IAAI;gBACF,8BAA8B;gBAC9B,MAAM,UAAU,IAAA,2LAAI,EAAC,gIAAO,EAAE;gBAC9B,MAAM,IAAA,oMAAY,EAAC;YACrB,EAAE,OAAO,GAAG;gBACV,sDAAsD;gBACtD,QAAQ,IAAI,CAAC,oCAAoC,KAAK;YACxD;QACF;QAEA,mBAAmB;QACnB,MAAM,IAAA,8KAAS,EAAC,IAAA,wKAAG,EAAC,2HAAE,EAAE,SAAS,QAAQ,eAAe,EAAE,EAAE;IAC9D;IAEA,2BAA2B;IAC3B,MAAM,IAAA,8KAAS,EAAC,IAAA,wKAAG,EAAC,2HAAE,EAAE,SAAS;AACnC;AAEe,SAAS,iBAAiB,EAAE,MAAM,EAAE,SAAS,EAAE,SAAS,EAAS;IAC9E,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IAEjC,eAAe;QACb,MAAM,OAAO,WAAW,UAAU;QAClC,MAAM,KAAK,QAAQ,CAAC,gBAAgB,EAAE,KAAK,4BAA4B,CAAC;QACxE,IAAI,CAAC,IAAI;QAET,IAAI;YACF,QAAQ;YACR,MAAM,eAAe;YACrB;QACF,EAAE,OAAO,GAAQ;YACf,MAAM,kBAAkB,CAAC,GAAG,WAAW,CAAC;QAC1C,SAAU;YACR,QAAQ;QACV;IACF;IAEA,qBACE,8OAAC;QACC,SAAS;QACT,UAAU;QACV,WAAU;QACV,OAAM;kBAEL,OAAO,UAAU;;;;;;AAGxB","debugId":null}},
    {"offset": {"line": 239, "column": 0}, "map": {"version":3,"sources":["file:///C:/chamama-forms/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { auth, db } from \"@/lib/firebaseClient\";\nimport { onAuthStateChanged } from \"firebase/auth\";\nimport { collection, query, where, getDocs, addDoc, serverTimestamp } from \"firebase/firestore\";\nimport DeleteFormButton from \"@/components/DeleteFormButton\";\n\ntype FormDoc = {\n  id: string;\n  title?: string;\n  ownerUid: string;\n  submissionCount?: number;\n};\n\nexport default function FormsIndexPage() {\n  const router = useRouter();\n  const [uid, setUid] = useState<string>(\"\");\n  const [forms, setForms] = useState<FormDoc[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // חובה להיות מחובר\n  useEffect(() => {\n    const unsub = onAuthStateChanged(auth, (u) => {\n      if (!u) router.replace(\"/login\");\n      else setUid(u.uid);\n    });\n    return () => unsub();\n  }, [router]);\n\n  // משיכת הטפסים של המשתמש\n  useEffect(() => {\n    if (!uid) return;\n    (async () => {\n      setLoading(true);\n      try {\n        const q = query(collection(db, \"forms\"), where(\"ownerUid\", \"==\", uid));\n        const snap = await getDocs(q);\n        setForms(snap.docs.map((d) => ({ id: d.id, ...(d.data() as any) })));\n      } finally {\n        setLoading(false);\n      }\n    })();\n  }, [uid]);\n\n  function copyLink(id: string) {\n    const url = `${location.origin}/f/${id}`;\n    navigator.clipboard.writeText(url).then(() => alert(\"הקישור הועתק ללוח\"));\n  }\n\n  async function createNew() {\n    const docRef = await addDoc(collection(db, \"forms\"), {\n      ownerUid: uid,\n      title: \"טופס חדש\",\n      targetGroups: [],\n      notifyStaffEmails: [],\n      schema: [],\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    });\n    router.push(`/forms/${docRef.id}/edit`);\n  }\n\n  return (\n    <main dir=\"rtl\" className=\"p-6 max-w-3xl mx-auto\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h1 className=\"text-2xl font-semibold\">הטפסים שלי</h1>\n        <button className=\"rounded bg-blue-600 text-white px-3 py-2\" onClick={createNew}>\n          + טופס חדש\n        </button>\n      </div>\n\n      {loading ? (\n        <div>טוען…</div>\n      ) : forms.length === 0 ? (\n        <div className=\"text-gray-600\">אין טפסים עדיין.</div>\n      ) : (\n        <ul className=\"space-y-2\">\n          {forms.map((f) => (\n            <li key={f.id} className=\"border rounded p-3 bg-white flex items-center justify-between\">\n              <div className=\"space-y-1\">\n                <div className=\"font-medium\">{f.title || \"(ללא כותרת)\"}</div>\n                <div className=\"text-xs text-gray-500\">התקבלו: {f.submissionCount || 0}</div>\n              </div>\n              <div className=\"flex items-center gap-4\">\n                <a className=\"underline\" href={`/forms/${f.id}/edit`}>עריכה</a>\n                <button type=\"button\" className=\"underline\" onClick={() => copyLink(f.id)}>\n                  העתק קישור להורה\n                </button>\n                <DeleteFormButton\n                  formId={f.id}\n                  formTitle={f.title}\n                  onDeleted={() => setForms((prev) => prev.filter((x) => x.id !== f.id))}\n                />\n              </div>\n            </li>\n          ))}\n        </ul>\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}