module.exports=[14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},92279,a=>{"use strict";a.s(["default",()=>j],92279);var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(30485);var e=a.i(31052),f=a.i(99996);a.i(69387);var g=a.i(60574);function h({value:d,onChange:e,placeholder:f="תיאור הטופס…"}){let g=(0,c.useRef)(null),h=(0,c.useRef)(null),i=(0,c.useRef)(!1),j=(0,c.useRef)("");return(0,c.useEffect)(()=>{let b=!1;return(async()=>{if(i.current||!g.current)return;i.current=!0;let c=(await a.A(18373)).default;g.current.innerHTML="";let k=document.createElement("div");g.current.appendChild(k);let l=new c(k,{theme:"snow",modules:{toolbar:[[{header:[1,2,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{align:[]},{direction:"rtl"}],["link","clean"]],clipboard:{matchVisual:!0}},formats:["header","bold","italic","underline","strike","list","bullet","align","direction","link"],placeholder:f});h.current=l,l.root.setAttribute("dir","rtl"),d&&(l.clipboard.dangerouslyPasteHTML(d),j.current=l.root.innerHTML),l.on("text-change",()=>{if(b)return;let a=l.root.innerHTML;a!==j.current&&(j.current=a,e(a))})})(),()=>{b=!0}},[]),(0,c.useEffect)(()=>{let a=h.current;a&&d&&d!==j.current&&(a.setContents([]),a.clipboard.dangerouslyPasteHTML(d),j.current=a.root.innerHTML)},[d]),(0,b.jsx)("div",{ref:g,className:"bg-white rounded"})}function i({value:a,onChange:d,title:e="אפשרויות"}){let f=(0,c.useRef)(null);function g(){d([...a||[],""]),setTimeout(()=>f.current?.focus(),0)}return(0,c.useEffect)(()=>{let b=a.length>1&&""===a[a.length-1]?a.slice(0,-1):a;b!==a&&d(b)},[]),(0,b.jsxs)("div",{dir:"rtl",className:"space-y-2",children:[(0,b.jsx)("div",{className:"font-medium",children:e}),(0,b.jsx)("div",{className:"space-y-2",children:(a||[]).map((c,e)=>{let h=e===a.length-1;return(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{ref:h?f:void 0,className:"border rounded p-2 flex-1",placeholder:`אפשרות #${e+1}`,value:c,onChange:b=>(function(b,c){let e=[...a];e[b]=c,d(e)})(e,b.target.value),onKeyDown:b=>{"Enter"===b.key&&(b.preventDefault(),a[e].trim()&&g())}}),(0,b.jsx)("button",{type:"button",className:"border rounded px-2 py-1",onClick:()=>{d(a.filter((a,b)=>b!==e))},"aria-label":"מחק",title:"מחק אפשרות",children:"✕"})]},e)})}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("button",{type:"button",className:"border rounded px-3 py-2",onClick:g,children:"+"})})]})}function j(){let{id:a}=(0,d.useParams)();(0,d.useRouter)();let[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!0);function t(a){let b={id:"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+Date.now().toString(36),type:a,label:"",required:!1};switch(a){case"text":b.label="שדה טקסט";break;case"textarea":b.label="איזור טקסט";break;case"parentName":b.label="שם ההורה";break;case"number":b.label="מספר";break;case"phone":b.label="טלפון";break;case"email":b.label='דוא"ל';break;case"consent":b.label="הסכמה",b.description="אני מאשר/ת ...";break;case"select":b.label="בחירה מרשימה",b.options=[];break;case"radio":b.label="בחירה",b.options=[];break;case"checkbox":b.label="בחירה מרובה",b.options=[];break;case"signature":b.label="חתימה"}o(a=>[...a,b])}function u(a,b){o(c=>c.map((c,d)=>d===a?{...c,...b}:c))}async function v(){try{q(!0),await (0,g.updateDoc)((0,g.doc)(f.db,"forms",a),{title:j,descriptionHtml:l,schema:n,updatedAt:(0,g.serverTimestamp)()})}finally{q(!1)}}return(0,c.useEffect)(()=>{let a=(0,e.onAuthStateChanged)(f.auth,a=>{a||(location.href="/login")});return()=>a()},[]),(0,c.useEffect)(()=>{let b=!1;return(async()=>{s(!0);try{let c=(await (0,g.getDoc)((0,g.doc)(f.db,"forms",a))).data();b||(k(c?.title||""),m(c?.descriptionHtml||""),o(c?.schema||[]))}finally{b||s(!1)}})(),()=>{b=!0}},[a]),r?(0,b.jsx)("main",{dir:"rtl",className:"p-6 max-w-6xl mx-auto",children:"טוען…"}):(0,b.jsxs)("main",{dir:"rtl",className:"p-6 max-w-6xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,b.jsx)("input",{className:"border p-2 rounded flex-1 text-xl",placeholder:"כותרת הטופס (נשמר גם כשם הטופס)",value:j,onChange:a=>k(a.target.value)}),(0,b.jsx)("button",{onClick:v,className:"border p-2 rounded",disabled:p,children:p?"שומר…":"שמור"}),(0,b.jsx)("button",{onClick:function(){window.open(`/f/${a}`,"_blank","noopener,noreferrer")},className:"border p-2 rounded",children:"תצוגה להורה"})]}),(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)(h,{value:l,onChange:m})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,b.jsx)("section",{className:"lg:col-span-2 lg:order-1 space-y-3",children:(0,b.jsxs)("ul",{className:"space-y-3",children:[0===n.length&&(0,b.jsx)("li",{className:"text-gray-500",children:"טרם הוספת שדות. הוסף רכיבים מהצד הימני."}),n.map((a,c)=>(0,b.jsxs)("li",{className:"border rounded p-3 bg-white",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs border px-2 py-1 rounded",children:a.type}),(0,b.jsx)("input",{className:"border p-1 flex-1 min-w-[200px]",value:a.label,onChange:a=>u(c,{label:a.target.value}),placeholder:"כותרת שדה"}),(0,b.jsxs)("label",{className:"flex items-center gap-1 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:!!a.required,onChange:a=>u(c,{required:a.target.checked})}),"נדרש"]}),(0,b.jsx)("button",{type:"button",className:"text-red-600",onClick:()=>{o(a=>a.filter((a,b)=>b!==c))},children:"מחק"})]}),["select","radio","checkbox"].includes(a.type)&&(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(i,{title:"אפשרויות לבחירה",value:a.options??[],onChange:a=>u(c,{options:a})})}),"consent"===a.type&&(0,b.jsx)("textarea",{className:"border p-2 w-full mt-2 rounded",placeholder:"תוכן ההסכמה שיוצג ליד הצ'קבוקס",value:a.description||"",onChange:a=>u(c,{description:a.target.value})})]},a.id))]})}),(0,b.jsx)("aside",{className:"lg:col-span-1 lg:order-2 space-y-2",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("text"),children:"שדה טקסט"}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("textarea"),children:"איזור טקסט"}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("parentName"),children:"שם ההורה"}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("number"),children:"שדה מספר"}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("phone"),children:"טלפון"}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("email"),children:'דוא"ל'}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("consent"),children:"הסכמה"}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("select"),children:"בחירה מרשימה"}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("radio"),children:"בחירה (radio)"}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("checkbox"),children:"בחירה מרובה"}),(0,b.jsx)("button",{className:"border p-2 rounded",onClick:()=>t("signature"),children:"חתימה"})]})})]})]})}},18373,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_41607b77._.js"].map(b=>a.l(b))).then(()=>b(1219)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9e497f43._.js.map