{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/chamama-forms/lib/firebaseClient.ts"],"sourcesContent":["import { initializeApp, getApps, getApp } from \"firebase/app\";\r\nimport { getAuth, connectAuthEmulator } from \"firebase/auth\";\r\nimport { getFirestore, connectFirestoreEmulator } from \"firebase/firestore\";\r\nimport { getStorage, connectStorageEmulator } from \"firebase/storage\";\r\nimport { getFunctions, connectFunctionsEmulator } from \"firebase/functions\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.NEXT_PUBLIC_FB_API_KEY!,\r\n  authDomain: process.env.NEXT_PUBLIC_FB_AUTH_DOMAIN!,\r\n  projectId: process.env.NEXT_PUBLIC_FB_PROJECT_ID!,\r\n  storageBucket: process.env.NEXT_PUBLIC_FB_STORAGE_BUCKET!,\r\n  appId: process.env.NEXT_PUBLIC_FB_APP_ID!,\r\n};\r\n\r\nexport const app = getApps().length ? getApp() : initializeApp(firebaseConfig);\r\n\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app);\r\nexport const storage = getStorage(app);\r\n// חשוב: אזור תואם ל-export של הפונקציה\r\nexport const functions = getFunctions(app, \"us-central1\");\r\n\r\n// חיבור אמולטורים לוקאלית\r\nif (typeof window !== \"undefined\" && location.hostname === \"localhost\") {\r\n  connectAuthEmulator(auth, \"http://127.0.0.1:9099\");\r\n  connectFirestoreEmulator(db, \"127.0.0.1\", 8080);\r\n  connectStorageEmulator(storage, \"127.0.0.1\", 9199);\r\n  connectFunctionsEmulator(functions, \"127.0.0.1\", 5001);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;;;;;;AAEA,MAAM,iBAAiB;IACrB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,KAAK;AACP;AAEO,MAAM,MAAM,IAAA,2KAAO,IAAG,MAAM,GAAG,IAAA,0KAAM,MAAK,IAAA,iLAAa,EAAC;AAExD,MAAM,OAAO,IAAA,6KAAO,EAAC;AACrB,MAAM,KAAK,IAAA,iLAAY,EAAC;AACxB,MAAM,UAAU,IAAA,kMAAU,EAAC;AAE3B,MAAM,YAAY,IAAA,sLAAY,EAAC,KAAK;AAE3C,0BAA0B;AAC1B","debugId":null}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///C:/chamama-forms/components/RichTextEditor.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef } from \"react\";\r\nimport \"quill/dist/quill.snow.css\";\r\n\r\n\r\ntype Props = {\r\n  value: string;\r\n  onChange: (html: string) => void;\r\n  placeholder?: string;\r\n};\r\n\r\nexport default function RichTextEditor({ value, onChange, placeholder }: Props) {\r\n  const hostRef = useRef<HTMLDivElement | null>(null);\r\n  const quillRef = useRef<any>(null);\r\n\r\n  // אתחול Quill חד-פעמי (רק בצד לקוח)\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    (async () => {\r\n      // תמיכה גם אם המודול מחזיר default וגם אם לא\r\n      const mod: any = await import(\"quill\");\r\n      const Quill = mod?.default ?? mod;\r\n      if (!mounted || !hostRef.current || quillRef.current) return;\r\n\r\n      const modules = {\r\n        toolbar: [\r\n          [{ header: [1, 2, 3, false] }],\r\n          [\"bold\", \"italic\", \"underline\", \"strike\"],\r\n          [{ list: \"ordered\" }, { list: \"bullet\" }],\r\n          [{ align: [] }, { direction: \"rtl\" }],\r\n          [\"link\"],\r\n          [\"clean\"],\r\n        ],\r\n        clipboard: { matchVisual: false },\r\n      };\r\n\r\n      const formats = [\r\n        \"header\",\r\n        \"bold\",\r\n        \"italic\",\r\n        \"underline\",\r\n        \"strike\",\r\n        \"list\",\r\n        \"bullet\",\r\n        \"align\",\r\n        \"direction\",\r\n        \"link\",\r\n      ];\r\n\r\n      const q = new Quill(hostRef.current, {\r\n        theme: \"snow\",\r\n        modules,\r\n        formats,\r\n        placeholder,\r\n      });\r\n\r\n      quillRef.current = q;\r\n\r\n      // RTL + עברית\r\n      q.root.setAttribute(\"dir\", \"rtl\");\r\n      q.root.setAttribute(\"lang\", \"he\");\r\n\r\n      // ערך התחלתי\r\n      if (value) {\r\n        q.clipboard.dangerouslyPasteHTML(value);\r\n      }\r\n\r\n      // שינויי טקסט → onChange\r\n      const handler = () => onChange(q.root.innerHTML);\r\n      q.on(\"text-change\", handler);\r\n\r\n      // ניקוי מאזינים ביציאה\r\n      return () => {\r\n        try { q.off(\"text-change\", handler); } catch {}\r\n      };\r\n    })();\r\n\r\n    return () => {\r\n      mounted = false;\r\n      quillRef.current = null;\r\n    };\r\n  }, []); // לאתחל פעם אחת\r\n\r\n  // סינכרון ערך חיצוני → עורך, בלי למחוק בחירה\r\n  useEffect(() => {\r\n    const q = quillRef.current;\r\n    if (!q || typeof value !== \"string\") return;\r\n\r\n    const current = q.root.innerHTML;\r\n    if (current === value) return;\r\n\r\n    const sel = q.getSelection();\r\n    q.clipboard.dangerouslyPasteHTML(value || \"\");\r\n    if (sel) q.setSelection(sel);\r\n  }, [value]);\r\n\r\n  // עטיפה כדי לבודד את ה-CSS של Quill\r\n  return (\r\n    <div className=\"quill-wrap border rounded bg-white\">\r\n      <div ref={hostRef} />\r\n      <style jsx>{`\r\n        .quill-wrap :global(.ql-container) {\r\n          min-height: 160px;\r\n          border-top: 0;\r\n        }\r\n        .quill-wrap :global(.ql-toolbar) {\r\n          border-bottom: 1px solid #e5e7eb; /* tailwind slate-200 */\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;AAEA;AAFA;;;;;AAYe,SAAS,eAAe,EAAE,KAAK,EAAE,QAAQ,EAAE,WAAW,EAAS;IAC5E,MAAM,UAAU,IAAA,+MAAM,EAAwB;IAC9C,MAAM,WAAW,IAAA,+MAAM,EAAM;IAE7B,oCAAoC;IACpC,IAAA,kNAAS,EAAC;QACR,IAAI,UAAU;QAEd,CAAC;YACC,6CAA6C;YAC7C,MAAM,MAAW;YACjB,MAAM,QAAQ,KAAK,WAAW;YAC9B,IAAI,CAAC,WAAW,CAAC,QAAQ,OAAO,IAAI,SAAS,OAAO,EAAE;YAEtD,MAAM,UAAU;gBACd,SAAS;oBACP;wBAAC;4BAAE,QAAQ;gCAAC;gCAAG;gCAAG;gCAAG;6BAAM;wBAAC;qBAAE;oBAC9B;wBAAC;wBAAQ;wBAAU;wBAAa;qBAAS;oBACzC;wBAAC;4BAAE,MAAM;wBAAU;wBAAG;4BAAE,MAAM;wBAAS;qBAAE;oBACzC;wBAAC;4BAAE,OAAO,EAAE;wBAAC;wBAAG;4BAAE,WAAW;wBAAM;qBAAE;oBACrC;wBAAC;qBAAO;oBACR;wBAAC;qBAAQ;iBACV;gBACD,WAAW;oBAAE,aAAa;gBAAM;YAClC;YAEA,MAAM,UAAU;gBACd;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;aACD;YAED,MAAM,IAAI,IAAI,MAAM,QAAQ,OAAO,EAAE;gBACnC,OAAO;gBACP;gBACA;gBACA;YACF;YAEA,SAAS,OAAO,GAAG;YAEnB,cAAc;YACd,EAAE,IAAI,CAAC,YAAY,CAAC,OAAO;YAC3B,EAAE,IAAI,CAAC,YAAY,CAAC,QAAQ;YAE5B,aAAa;YACb,IAAI,OAAO;gBACT,EAAE,SAAS,CAAC,oBAAoB,CAAC;YACnC;YAEA,yBAAyB;YACzB,MAAM,UAAU,IAAM,SAAS,EAAE,IAAI,CAAC,SAAS;YAC/C,EAAE,EAAE,CAAC,eAAe;YAEpB,uBAAuB;YACvB,OAAO;gBACL,IAAI;oBAAE,EAAE,GAAG,CAAC,eAAe;gBAAU,EAAE,OAAM,CAAC;YAChD;QACF,CAAC;QAED,OAAO;YACL,UAAU;YACV,SAAS,OAAO,GAAG;QACrB;IACF,GAAG,EAAE,GAAG,gBAAgB;IAExB,6CAA6C;IAC7C,IAAA,kNAAS,EAAC;QACR,MAAM,IAAI,SAAS,OAAO;QAC1B,IAAI,CAAC,KAAK,OAAO,UAAU,UAAU;QAErC,MAAM,UAAU,EAAE,IAAI,CAAC,SAAS;QAChC,IAAI,YAAY,OAAO;QAEvB,MAAM,MAAM,EAAE,YAAY;QAC1B,EAAE,SAAS,CAAC,oBAAoB,CAAC,SAAS;QAC1C,IAAI,KAAK,EAAE,YAAY,CAAC;IAC1B,GAAG;QAAC;KAAM;IAEV,oCAAoC;IACpC,qBACE,8OAAC;kDAAc;;0BACb,8OAAC;gBAAI,KAAK;;;;;;;;;;;;;;;;;AAYhB","debugId":null}},
    {"offset": {"line": 312, "column": 0}, "map": {"version":3,"sources":["file:///C:/chamama-forms/app/forms/%5Bid%5D/edit/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState, Fragment } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport { auth, db } from \"@/lib/firebaseClient\";\r\nimport { doc, getDoc, updateDoc, serverTimestamp } from \"firebase/firestore\";\r\nimport RichTextEditor from \"@/components/RichTextEditor\";\r\n\r\nimport {\r\n  DndContext,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  DragStartEvent,\r\n  DragOverEvent,\r\n  DragEndEvent,\r\n  useDroppable,\r\n  useDraggable,\r\n} from \"@dnd-kit/core\";\r\nimport {\r\n  SortableContext,\r\n  useSortable,\r\n  verticalListSortingStrategy,\r\n  arrayMove,\r\n} from \"@dnd-kit/sortable\";\r\nimport { CSS } from \"@dnd-kit/utilities\";\r\n\r\n/* ---------------------- טיפוסים ---------------------- */\r\ntype FieldType =\r\n  | \"text\"\r\n  | \"textarea\"\r\n  | \"parentName\"\r\n  | \"number\"\r\n  | \"phone\"\r\n  | \"email\"\r\n  | \"consent\"\r\n  | \"select\"\r\n  | \"radio\"\r\n  | \"checkbox\"\r\n  | \"signature\"\r\n  | \"richtext\";\r\n\r\ntype Field = {\r\n  id: string;\r\n  type: FieldType;\r\n  label: string;\r\n  required?: boolean;\r\n  options?: string[];\r\n  description?: string;\r\n};\r\n\r\n/* ---------------------- עזרים ---------------------- */\r\nfunction uid() {\r\n  if (typeof crypto !== \"undefined\" && \"randomUUID\" in crypto) return crypto.randomUUID();\r\n  return \"id-\" + Math.random().toString(36).slice(2) + Date.now().toString(36);\r\n}\r\n\r\nfunction createBaseField(type: FieldType): Field {\r\n  const base: Field = { id: uid(), type, label: \"\", required: false };\r\n  switch (type) {\r\n    case \"text\": base.label = \"שדה טקסט\"; break;\r\n    case \"textarea\": base.label = \"איזור טקסט\"; break;\r\n    case \"parentName\": base.label = \"שם ההורה\"; break;\r\n    case \"number\": base.label = \"מספר\"; break;\r\n    case \"phone\": base.label = \"טלפון\"; break;\r\n    case \"email\": base.label = 'דוא\"ל'; break;\r\n    case \"consent\": base.label = \"הסכמה\"; base.description = \"אני מאשר/ת ...\"; break;\r\n    case \"select\": base.label = \"בחירה מרשימה\"; base.options = []; break;\r\n    case \"radio\": base.label = \"בחירה\"; base.options = []; break;\r\n    case \"checkbox\": base.label = \"בחירה מרובה\"; base.options = []; break;\r\n    case \"signature\": base.label = \"חתימה\"; break;\r\n    case \"richtext\": base.label = \"טקסט עשיר\"; break;\r\n    default: base.label = \"שדה\";\r\n  }\r\n  return base;\r\n}\r\n\r\n/* ---------------------- קומפוננטות עזר ---------------------- */\r\nfunction SortableFieldRow({\r\n  field,\r\n  onUpdate,\r\n  onDelete,\r\n}: {\r\n  field: Field;\r\n  onUpdate: (patch: Partial<Field>) => void;\r\n  onDelete: () => void;\r\n}) {\r\n  const { attributes, listeners, setNodeRef, transform, transition, isDragging } =\r\n    useSortable({ id: field.id });\r\n\r\n  const style: React.CSSProperties = {\r\n    transform: CSS.Transform.toString(transform),\r\n    transition,\r\n    opacity: isDragging ? 0.5 : 1,\r\n    background: \"white\",\r\n  };\r\n\r\n  return (\r\n    <li ref={setNodeRef} style={style} className=\"border p-2 rounded bg-white\">\r\n      <div className=\"flex gap-2 items-center\">\r\n        <button\r\n          type=\"button\"\r\n          className=\"px-2 py-1 border rounded cursor-grab select-none\"\r\n          {...attributes}\r\n          {...listeners}\r\n          title=\"גרור לשינוי סדר\"\r\n        >\r\n          ⠿\r\n        </button>\r\n\r\n        <span className=\"text-xs px-2 py-1 border rounded\">{field.type}</span>\r\n\r\n        <input\r\n          className=\"border p-1 flex-1\"\r\n          value={field.label}\r\n          onChange={(e) => onUpdate({ label: e.target.value })}\r\n        />\r\n\r\n        <label className=\"flex items-center gap-1 text-sm\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={!!field.required}\r\n            onChange={(e) => onUpdate({ required: e.target.checked })}\r\n          />\r\n          נדרש\r\n        </label>\r\n\r\n        <button type=\"button\" className=\"text-red-600\" onClick={onDelete}>\r\n          מחק\r\n        </button>\r\n      </div>\r\n\r\n      {(field.type === \"select\" || field.type === \"radio\" || field.type === \"checkbox\") && (\r\n        <div className=\"mt-2\">\r\n          <OptionsEditor\r\n            value={field.options || []}\r\n            onChange={(opts) => onUpdate({ options: opts })}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {field.type === \"consent\" && (\r\n        <textarea\r\n          className=\"border p-2 w-full rounded mt-2\"\r\n          rows={3}\r\n          placeholder=\"פירוט ההסכמה שיוצג להורים…\"\r\n          value={field.description || \"\"}\r\n          onChange={(e) => onUpdate({ description: e.target.value })}\r\n        />\r\n      )}\r\n    </li>\r\n  );\r\n}\r\n\r\nfunction OptionsEditor({ value, onChange }: { value: string[]; onChange: (next: string[]) => void; }) {\r\n  const [input, setInput] = useState(\"\");\r\n  function addOpt() {\r\n    const v = input.trim();\r\n    if (!v || value.includes(v)) return;\r\n    onChange([...value, v]);\r\n    setInput(\"\");\r\n  }\r\n  function removeOpt(opt: string) { onChange(value.filter((x) => x !== opt)); }\r\n  function renameOpt(i: number, txt: string) {\r\n    const next = value.slice(); next[i] = txt; onChange(next.filter(Boolean));\r\n  }\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <div className=\"flex gap-2\">\r\n        <input\r\n          className=\"border p-2 rounded flex-1\"\r\n          placeholder=\"הוספת אפשרות…\"\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          onKeyDown={(e) => e.key === \"Enter\" && addOpt()}\r\n        />\r\n        <button type=\"button\" className=\"border px-3 rounded\" onClick={addOpt}>הוסף</button>\r\n      </div>\r\n      <ul className=\"space-y-1\">\r\n        {value.map((opt, i) => (\r\n          <li key={opt + i} className=\"flex items-center gap-2\">\r\n            <span className=\"text-gray-500 text-xs\">{i + 1}.</span>\r\n            <input className=\"border p-1 rounded flex-1\" value={opt} onChange={(e) => renameOpt(i, e.target.value)} />\r\n            <button type=\"button\" className=\"text-red-600\" onClick={() => removeOpt(opt)}>מחק</button>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n\r\n/** droppable כשאין בכלל פריטים */\r\nfunction EmptyCanvasDroppable({ children }: { children: React.ReactNode }) {\r\n  const { isOver, setNodeRef } = useDroppable({ id: \"canvas\" });\r\n  return (\r\n    <div ref={setNodeRef} className={`rounded border-2 p-1 ${isOver ? \"border-blue-400\" : \"border-dashed border-gray-300\"}`}>\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\n/** דרופ־זון בקצה התחתון כדי שדרופ על הריק יוסיף בסוף */\r\nfunction EndDropZone({ show }: { show: boolean }) {\r\n  const { setNodeRef, isOver } = useDroppable({ id: \"end\" });\r\n  return (\r\n    <li ref={setNodeRef} className={`px-2 h-6 ${isOver ? \"bg-blue-50\" : \"\"}`}>\r\n      {show && <div className=\"h-0.5 bg-blue-500 rounded-full my-1\" />}\r\n    </li>\r\n  );\r\n}\r\n\r\n/** פריט פאלאט: גם גריר, גם לחיץ */\r\nfunction DraggablePaletteItem({ type, label, onAdd }: { type: FieldType; label: string; onAdd: (t: FieldType) => void; }) {\r\n  const id = `palette:${type}`;\r\n  const { attributes, listeners, setNodeRef, transform, isDragging } = useDraggable({ id, data: { from: \"palette\", type } });\r\n  const style: React.CSSProperties = {\r\n    transform: transform ? CSS.Translate.toString(transform) : undefined,\r\n    opacity: isDragging ? 0.6 : 1,\r\n  };\r\n  return (\r\n    <button\r\n      ref={setNodeRef as any}\r\n      type=\"button\"\r\n      {...attributes}\r\n      {...listeners}\r\n      onClick={() => onAdd(type)}\r\n      style={style}\r\n      className=\"border p-2 rounded bg-white\"\r\n      title=\"לחץ להוספה או גרור אל אזור הטופס\"\r\n    >\r\n      {label}\r\n    </button>\r\n  );\r\n}\r\n\r\n/* ---------------------- העמוד ---------------------- */\r\nexport default function EditFormPage() {\r\n  const { id } = useParams<{ id: string }>();\r\n\r\n  const [title, setTitle] = useState(\"\");\r\n  const [descriptionHtml, setDescriptionHtml] = useState(\"\");\r\n  const [schema, setSchema] = useState<Field[]>([]);\r\n  const [saving, setSaving] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // אינדקס ההכנסה (לפני מי מכניסים)\r\n  const [dropIndex, setDropIndex] = useState<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    const unsub = onAuthStateChanged(auth, (u) => { if (!u) location.href = \"/login\"; });\r\n    return () => unsub();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    (async () => {\r\n      setLoading(true);\r\n      try {\r\n        const snap = await getDoc(doc(db, \"forms\", id));\r\n        const data = snap.data() as any;\r\n        if (!cancelled) {\r\n          setTitle(data?.title || \"\");\r\n          setDescriptionHtml(data?.descriptionHtml || \"\");\r\n          setSchema((data?.schema || []) as Field[]);\r\n        }\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    })();\r\n    return () => { cancelled = true; };\r\n  }, [id]);\r\n\r\n  function addField(type: FieldType) { setSchema((prev) => [...prev, createBaseField(type)]); }\r\n  function insertFieldAt(type: FieldType, index: number) {\r\n    const field = createBaseField(type);\r\n    setSchema((prev) => {\r\n      const i = Math.max(0, Math.min(index, prev.length));\r\n      return [...prev.slice(0, i), field, ...prev.slice(i)];\r\n    });\r\n  }\r\n  function updateField(index: number, patch: Partial<Field>) {\r\n    setSchema((prev) => prev.map((f, i) => (i === index ? { ...f, ...patch } : f)));\r\n  }\r\n  function removeField(index: number) { setSchema((prev) => prev.filter((_, i) => i !== index)); }\r\n\r\n  async function save() {\r\n    try {\r\n      setSaving(true);\r\n      await updateDoc(doc(db, \"forms\", id), { title, descriptionHtml, schema, updatedAt: serverTimestamp() });\r\n    } finally { setSaving(false); }\r\n  }\r\n  function openPreview() { window.open(`/f/${id}`, \"_blank\", \"noopener,noreferrer\"); }\r\n\r\n  const sensors = useSensors(useSensor(PointerSensor, { activationConstraint: { distance: 5 } }));\r\n\r\n  function handleDragStart(_: DragStartEvent) { setDropIndex(null); }\r\n\r\n  function handleDragOver(e: DragOverEvent) {\r\n    const { over } = e;\r\n    if (!over) { setDropIndex(null); return; }\r\n\r\n    if (over.id === \"canvas\") { setDropIndex(0); return; }       // רשימה ריקה\r\n    if (over.id === \"end\")    { setDropIndex(schema.length); return; } // דרופ בסוף\r\n\r\n    // כשעובדים מול פריט — נכניס לפניו\r\n    const overIdx = schema.findIndex((f) => f.id === String(over.id));\r\n    setDropIndex(overIdx === -1 ? null : overIdx);\r\n  }\r\n\r\n  function handleDragEnd(e: DragEndEvent) {\r\n    const { active } = e;\r\n    const targetIndex = dropIndex;\r\n    setDropIndex(null);\r\n    if (targetIndex == null) return;\r\n\r\n    const fromPalette = active.data?.current?.from === \"palette\";\r\n    const paletteType = active.data?.current?.type as FieldType | undefined;\r\n\r\n    if (fromPalette && paletteType) {\r\n      insertFieldAt(paletteType, targetIndex);\r\n      return;\r\n    }\r\n\r\n    const oldIndex = schema.findIndex((f) => f.id === String(active.id));\r\n    if (oldIndex === -1) return;\r\n    setSchema((items) => arrayMove(items, oldIndex, targetIndex));\r\n  }\r\n\r\n  if (loading) return <main dir=\"rtl\" className=\"p-6 max-w-6xl mx-auto\">טוען…</main>;\r\n\r\n  return (\r\n    <main dir=\"rtl\" className=\"p-6 max-w-6xl mx-auto\">\r\n      <div className=\"flex flex-wrap items-center gap-3 mb-4\">\r\n        <input\r\n          className=\"border p-2 rounded flex-1 text-xl\"\r\n          placeholder=\"כותרת הטופס (נשמר גם כשם הטופס)\"\r\n          value={title}\r\n          onChange={(e) => setTitle(e.target.value)}\r\n        />\r\n        <button onClick={save} className=\"border p-2 rounded\" disabled={saving}>\r\n          {saving ? \"שומר…\" : \"שמור\"}\r\n        </button>\r\n        <button onClick={openPreview} className=\"border p-2 rounded\">תצוגה להורה</button>\r\n      </div>\r\n\r\n      <div className=\"mb-6\">\r\n        <RichTextEditor value={descriptionHtml} onChange={setDescriptionHtml} />\r\n      </div>\r\n\r\n      <DndContext sensors={sensors} onDragStart={handleDragStart} onDragOver={handleDragOver} onDragEnd={handleDragEnd}>\r\n        {/* שתי עמודות: משמאל קנבס (2/3), מימין ארגז (1/3) */}\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\r\n          {/* קנבס */}\r\n          <section className=\"sm:col-span-2 space-y-3\">\r\n            <h2 className=\"text-lg font-semibold mb-2\">שדות הטופס</h2>\r\n\r\n            {schema.length === 0 ? (\r\n              <EmptyCanvasDroppable>\r\n                <ul className=\"space-y-2 min-h-[120px] p-4 rounded bg-gray-50\">\r\n                  <li className=\"text-gray-500 text-sm border rounded bg-white p-4\">\r\n                    גרור/י רכיב מהצד הימני כדי להתחיל לבנות טופס.\r\n                  </li>\r\n                </ul>\r\n              </EmptyCanvasDroppable>\r\n            ) : (\r\n              <SortableContext items={schema.map((f) => f.id)} strategy={verticalListSortingStrategy}>\r\n                <ul className=\"space-y-2 min-h-[120px] p-1 rounded bg-gray-50\">\r\n                  {/* קו הטלה לפני האיבר הראשון */}\r\n                  {dropIndex === 0 && (\r\n                    <li aria-hidden className=\"px-2\">\r\n                      <div className=\"h-0.5 bg-blue-500 rounded-full my-1\" />\r\n                    </li>\r\n                  )}\r\n\r\n                  {schema.map((f, idx) => (\r\n                    <Fragment key={f.id}>\r\n                      {/* קו הטלה לפני כל איבר שריחפנו מעליו */}\r\n                      {dropIndex === idx && (\r\n                        <li aria-hidden className=\"px-2\">\r\n                          <div className=\"h-0.5 bg-blue-500 rounded-full my-1\" />\r\n                        </li>\r\n                      )}\r\n                      <SortableFieldRow\r\n                        field={f}\r\n                        onUpdate={(patch) => updateField(idx, patch)}\r\n                        onDelete={() => removeField(idx)}\r\n                      />\r\n                    </Fragment>\r\n                  ))}\r\n\r\n                  {/* קו/דרופ בסוף ממש */}\r\n                  <EndDropZone show={dropIndex === schema.length} />\r\n                </ul>\r\n              </SortableContext>\r\n            )}\r\n          </section>\r\n\r\n          {/* ארגז רכיבים */}\r\n          <aside className=\"sm:col-span-1 space-y-2 sm:sticky sm:top-4 self-start\">\r\n            <h2 className=\"text-lg font-semibold mb-2\">רכיבי טופס</h2>\r\n            <div className=\"grid grid-cols-2 gap-2\">\r\n              <DraggablePaletteItem type=\"text\" label=\"שדה טקסט\" onAdd={addField} />\r\n              <DraggablePaletteItem type=\"textarea\" label=\"איזור טקסט\" onAdd={addField} />\r\n              <DraggablePaletteItem type=\"parentName\" label=\"שם ההורה\" onAdd={addField} />\r\n              <DraggablePaletteItem type=\"number\" label=\"שדה מספר\" onAdd={addField} />\r\n              <DraggablePaletteItem type=\"phone\" label=\"טלפון\" onAdd={addField} />\r\n              <DraggablePaletteItem type=\"email\" label='דוא\"ל' onAdd={addField} />\r\n              <DraggablePaletteItem type=\"consent\" label=\"הסכמה\" onAdd={addField} />\r\n              <DraggablePaletteItem type=\"select\" label=\"בחירה מרשימה\" onAdd={addField} />\r\n              <DraggablePaletteItem type=\"radio\" label=\"בחירה (radio)\" onAdd={addField} />\r\n              <DraggablePaletteItem type=\"checkbox\" label=\"בחירה מרובה\" onAdd={addField} />\r\n              <DraggablePaletteItem type=\"signature\" label=\"חתימה\" onAdd={addField} />\r\n            </div>\r\n          </aside>\r\n        </div>\r\n      </DndContext>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}