{"version":3,"sources":["turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/module.compiled.js","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","turbopack:///[project]/app/f/[id]/page.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","\"use client\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { db, storage } from \"@/lib/firebaseClient\";\r\nimport { doc, getDoc, collection, addDoc, serverTimestamp } from \"firebase/firestore\";\r\nimport { ref, uploadString, getDownloadURL } from \"firebase/storage\";\r\nimport SignaturePad from \"@/components/SignaturePad\";\r\n\r\ntype Field = { id:string; type:string; label:string; options?:string[]; required?:boolean; };\r\n\r\nexport default function PublicForm({ params }: { params: { id: string } }) {\r\n  const formId = params.id;\r\n  const [loading,setLoading]=useState(true);\r\n  const [form,setForm]=useState<any>(null);\r\n  const [answers,setAnswers]=useState<Record<string,any>>({});\r\n  const [sigData,setSigData]=useState<string>(\"\");\r\n  const [msg,setMsg]=useState(\"\"); const [sent,setSent]=useState(false);\r\n\r\n  useEffect(()=>{ (async()=>{\r\n    const snap=await getDoc(doc(db,\"forms\",formId));\r\n    if(!snap.exists()){ setMsg(\"טופס לא נמצא\"); setLoading(false); return; }\r\n    setForm(snap.data()); setLoading(false);\r\n  })(); },[formId]);\r\n\r\n  const fields: Field[] = useMemo(()=>form?.schema || [], [form]);\r\n  const requiredIds = useMemo(()=>fields.filter(f=>f.required).map(f=>f.id), [fields]);\r\n  const hasSignatureField = useMemo(()=>fields.some(f=>f.type===\"signature\"), [fields]);\r\n\r\n  function renderField(f:Field){\r\n    const v=answers[f.id]??(f.type===\"checkbox\"?[]:\"\");\r\n    const label = <div className=\"font-medium mb-1\">{f.label}{f.required && <span className=\"text-red-600\"> *</span>}</div>;\r\n    if(f.type===\"richtext\") return <div className=\"border p-2 rounded bg-white\"><div className=\"prose\" dangerouslySetInnerHTML={{__html: String(v||\"\")}}/></div>;\r\n    if(f.type===\"text\") return <>{label}<input className=\"border p-2 w-full\" value={v} onChange={e=>setAnswers(a=>({...a,[f.id]:e.target.value}))}/></>;\r\n    if(f.type===\"phone\") return <>{label}<input className=\"border p-2 w-full\" inputMode=\"tel\" value={v} onChange={e=>setAnswers(a=>({...a,[f.id]:e.target.value}))}/></>;\r\n    if(f.type===\"email\") return <>{label}<input className=\"border p-2 w-full\" inputMode=\"email\" value={v} onChange={e=>setAnswers(a=>({...a,[f.id]:e.target.value}))}/></>;\r\n    if(f.type===\"select\") return <>{label}<select className=\"border p-2 w-full\" value={v} onChange={e=>setAnswers(a=>({...a,[f.id]:e.target.value}))}><option value=\"\">בחר/י</option>{(f.options||[]).map(o=><option key={o} value={o}>{o}</option>)}</select></>;\r\n    if(f.type===\"radio\") return <>{label}<div className=\"flex flex-wrap gap-3\">{(f.options||[]).map(o=><label key={o} className=\"flex items-center gap-1\"><input type=\"radio\" checked={v===o} onChange={()=>setAnswers(a=>({...a,[f.id]:o}))}/>{o}</label>)}</div></>;\r\n    if(f.type===\"checkbox\"){ const set=new Set<string>(Array.isArray(v)?v:[]);\r\n      return <>{label}<div className=\"flex flex-wrap gap-3\">{(f.options||[]).map(o=>{\r\n        const checked=set.has(o);\r\n        return <label key={o} className=\"flex items-center gap-1\"><input type=\"checkbox\" checked={checked} onChange={e=>{\r\n          const next=new Set(set); e.target.checked?next.add(o):next.delete(o);\r\n          setAnswers(a=>({...a,[f.id]:Array.from(next)}));\r\n        }}/>{o}</label>;\r\n      })}</div></>;\r\n    }\r\n    if(f.type===\"signature\") return <>{label}<SignaturePad onSave={(d)=>setSigData(d)}/></>;\r\n    return <div className=\"text-sm text-gray-500\">סוג שדה לא נתמך</div>;\r\n  }\r\n\r\n  function validate(): string | null {\r\n    for(const id of requiredIds){\r\n      const val = answers[id];\r\n      if(val==null || (typeof val===\"string\" && !val.trim()) || (Array.isArray(val) && val.length===0)) {\r\n        return \"נא למלא את כל השדות החובה\";\r\n      }\r\n    }\r\n    if(hasSignatureField && !sigData) return \"נדרשת חתימה\";\r\n    return null;\r\n  }\r\n\r\n  async function onSubmit(){\r\n    setMsg(\"\");\r\n    const err = validate();\r\n    if(err){ setMsg(err); return; }\r\n    try{\r\n      let signatureUrl = \"\";\r\n      if(sigData){\r\n        const r = ref(storage, `signatures/public/${formId}-${Date.now()}.png`);\r\n        await uploadString(r, sigData, \"data_url\");\r\n        signatureUrl = await getDownloadURL(r);\r\n      }\r\n      await addDoc(collection(db,\"forms\",formId,\"submissions\"),{\r\n        publicId: crypto.randomUUID(),\r\n        answers, signatureUrl, status:\"submitted\", submittedAt: serverTimestamp()\r\n      });\r\n      setSent(true);\r\n      setMsg(\"✅ הטופס נשלח בהצלחה. תודה!\");\r\n    }catch(e:any){ setMsg(\"שגיאה בשליחה: \"+(e?.message||e)); }\r\n  }\r\n\r\n  if(loading) return <main className=\"p-6\">טוען…</main>;\r\n  if(!form) return <main className=\"p-6\">{msg||\"טופס לא נמצא\"}</main>;\r\n\r\n  return (\r\n    <main dir=\"rtl\" className=\"p-6 max-w-2xl mx-auto\">\r\n      <h1 className=\"text-2xl mb-4\">{form.title||\"טופס\"}</h1>\r\n      <div className=\"space-y-4\">\r\n        {fields.map(f=>(<div key={f.id} className=\"border p-3 rounded\">{renderField(f)}</div>))}\r\n        <div className=\"flex gap-2\">\r\n          <button className=\"border p-2\" onClick={onSubmit} disabled={sent}>{sent?\"נשלח\":\"שליחה\"}</button>\r\n          <button className=\"border p-2\" onClick={()=>history.back()}>ביטול</button>\r\n        </div>\r\n        {msg && <div className=\"text-sm mt-2\">{msg}</div>}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}