module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},46697,a=>{"use strict";a.s(["default",()=>h]);var b=a.i(87924),c=a.i(72131),d=a.i(99996);a.i(69387);var e=a.i(60574);a.i(60121);var f=a.i(5420),g=a.i(11769);function h({params:a}){let h=a.id,[i,j]=(0,c.useState)(!0),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)({}),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{let a=await (0,e.getDoc)((0,e.doc)(d.db,"forms",h));if(!a.exists()){r("טופס לא נמצא"),j(!1);return}l(a.data()),j(!1)})()},[h]);let u=(0,c.useMemo)(()=>k?.schema||[],[k]),v=(0,c.useMemo)(()=>u.filter(a=>a.required).map(a=>a.id),[u]),w=(0,c.useMemo)(()=>u.some(a=>"signature"===a.type),[u]);async function x(){r("");let a=function(){for(let a of v){let b=m[a];if(null==b||"string"==typeof b&&!b.trim()||Array.isArray(b)&&0===b.length)return"נא למלא את כל השדות החובה"}return w&&!o?"נדרשת חתימה":null}();if(a)return void r(a);try{let a="";if(o){let b=(0,f.ref)(d.storage,`signatures/public/${h}-${Date.now()}.png`);await (0,f.uploadString)(b,o,"data_url"),a=await (0,f.getDownloadURL)(b)}await (0,e.addDoc)((0,e.collection)(d.db,"forms",h,"submissions"),{publicId:crypto.randomUUID(),answers:m,signatureUrl:a,status:"submitted",submittedAt:(0,e.serverTimestamp)()}),t(!0),r("✅ הטופס נשלח בהצלחה. תודה!")}catch(a){r("שגיאה בשליחה: "+(a?.message||a))}}return i?(0,b.jsx)("main",{className:"p-6",children:"טוען…"}):k?(0,b.jsxs)("main",{dir:"rtl",className:"p-6 max-w-2xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-2xl mb-4",children:k.title||"טופס"}),(0,b.jsxs)("div",{className:"space-y-4",children:[u.map(a=>(0,b.jsx)("div",{className:"border p-3 rounded",children:function(a){let c=m[a.id]??("checkbox"===a.type?[]:""),d=(0,b.jsxs)("div",{className:"font-medium mb-1",children:[a.label,a.required&&(0,b.jsx)("span",{className:"text-red-600",children:" *"})]});if("richtext"===a.type)return(0,b.jsx)("div",{className:"border p-2 rounded bg-white",children:(0,b.jsx)("div",{className:"prose",dangerouslySetInnerHTML:{__html:String(c||"")}})});if("text"===a.type)return(0,b.jsxs)(b.Fragment,{children:[d,(0,b.jsx)("input",{className:"border p-2 w-full",value:c,onChange:b=>n(c=>({...c,[a.id]:b.target.value}))})]});if("phone"===a.type)return(0,b.jsxs)(b.Fragment,{children:[d,(0,b.jsx)("input",{className:"border p-2 w-full",inputMode:"tel",value:c,onChange:b=>n(c=>({...c,[a.id]:b.target.value}))})]});if("email"===a.type)return(0,b.jsxs)(b.Fragment,{children:[d,(0,b.jsx)("input",{className:"border p-2 w-full",inputMode:"email",value:c,onChange:b=>n(c=>({...c,[a.id]:b.target.value}))})]});if("select"===a.type)return(0,b.jsxs)(b.Fragment,{children:[d,(0,b.jsxs)("select",{className:"border p-2 w-full",value:c,onChange:b=>n(c=>({...c,[a.id]:b.target.value})),children:[(0,b.jsx)("option",{value:"",children:"בחר/י"}),(a.options||[]).map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]});if("radio"===a.type)return(0,b.jsxs)(b.Fragment,{children:[d,(0,b.jsx)("div",{className:"flex flex-wrap gap-3",children:(a.options||[]).map(d=>(0,b.jsxs)("label",{className:"flex items-center gap-1",children:[(0,b.jsx)("input",{type:"radio",checked:c===d,onChange:()=>n(b=>({...b,[a.id]:d}))}),d]},d))})]});if("checkbox"===a.type){let e=new Set(Array.isArray(c)?c:[]);return(0,b.jsxs)(b.Fragment,{children:[d,(0,b.jsx)("div",{className:"flex flex-wrap gap-3",children:(a.options||[]).map(c=>{let d=e.has(c);return(0,b.jsxs)("label",{className:"flex items-center gap-1",children:[(0,b.jsx)("input",{type:"checkbox",checked:d,onChange:b=>{let d=new Set(e);b.target.checked?d.add(c):d.delete(c),n(b=>({...b,[a.id]:Array.from(d)}))}}),c]},c)})})]})}return"signature"===a.type?(0,b.jsxs)(b.Fragment,{children:[d,(0,b.jsx)(g.default,{onSave:a=>p(a)})]}):(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"סוג שדה לא נתמך"})}(a)},a.id)),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{className:"border p-2",onClick:x,disabled:s,children:s?"נשלח":"שליחה"}),(0,b.jsx)("button",{className:"border p-2",onClick:()=>history.back(),children:"ביטול"})]}),q&&(0,b.jsx)("div",{className:"text-sm mt-2",children:q})]})]}):(0,b.jsx)("main",{className:"p-6",children:q||"טופס לא נמצא"})}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__7f40a5a3._.js.map